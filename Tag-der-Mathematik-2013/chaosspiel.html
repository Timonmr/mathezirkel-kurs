<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Chaosspiel</title>

<style type="text/css" media="screen">
  body {
    background: #fff;
    font-family: Verdana, sans-serif;
    font-size: 1em;
    line-height: 1.3em;
    margin: 10px;
  }
  #page { background: #ffffff; margin: 50px; border: 2px solid #c0c0c0; padding: 10px; }
  #header { background: #4b6983; border: 2px solid #7590ae; text-align: center; padding: 10px; color: #ffffff; }
  #header h1 { color: #ffffff; }
  #body { padding: 10px; }

  th { text-align: right; }
</style>
</head>

<body>

<audio controls autoplay loop id="audio">
  <source src="tetris.mp3" type="audio/mpeg">
Your browser does not support the audio element.
</audio>

<script type="text/javascript">
  var intensity = 0;
  function updatePlaybackRate () {
    if(document.getElementById('audio'))
      document.getElementById('audio').playbackRate =
        intensity > 0 ? 0.4 + intensity / 10 : 0;
  }
  function recordStep () {
    intensity = intensity + 1;
    updatePlaybackRate();
    updateStats();
  }
  updatePlaybackRate();
  window.setInterval(function () {
    intensity = 0.5 * intensity;
    updatePlaybackRate();
  }, 1000);
</script>

<canvas id="canvas">
  Dieser Browser kann kein HTML5-canvas-Element darstellen.
</canvas>

<div style="float: right">
  <div id="nr0">0</div>
  <div id="nr1">0</div>
  <div id="nr2">0</div>
</div>

<script type="text/javascript" src="seedrandom.js"></script>
<script type="text/javascript" src="chaosspiel.js"></script>

<script type="text/javascript">
  var chaosGame = new ChaosGame(1000,1000,3,1/2);

  var canvas = document.getElementById('canvas');
  var ctx    = canvas.getContext('2d');
  canvas.setAttribute('width', 1000);
  canvas.setAttribute('height', 1000);
  ctx.lineWidth = 4;

  chaosGame.doReset(ctx);

  canvas.addEventListener("click", function (ev) {
    chaosGame.initPos = [event.pageX - canvas.offsetLeft, event.pageY - canvas.offsetTop];
    chaosGame.doReset(ctx);
    chaosGame.doFullGame(ctx, document.getElementById('numPoints').innerText);
  }, false);

  var key2vertex = {
    'Y': 0,
    'X': 1,
    'C': 2,
    'I': 0,
    'O': 1,
    'P': 2
  };

  function updateStats () {
    if(chaosGame.numVertices != 3) return;

    for(var j = 0; j < chaosGame.numVertices; j++) {
      document.getElementById("nr" + j).innerText = chaosGame.stats[j];
    }
  }

  document.getElementsByTagName("body")[0].addEventListener("keyup", function (ev) {
    var j = key2vertex[String.fromCharCode(ev.which)];
    if(j != undefined) {
      var p = chaosGame.vertices[j];

      chaosGame.doStep(ctx, p, j);
      recordStep();
    }
  }, false);
</script>

<table style="float: right">
  <tr>
    <th>Anzahl Ecken</th>
    <td>
      <input type="range" min="3" max="100" value="3" style="width: 60em" onchange="
        document.getElementById('numVertices').innerText = this.value;
        chaosGame.numVertices = this.value;
        chaosGame.initVertices();
        chaosGame.doReset(ctx);
        chaosGame.doFullGame(ctx, document.getElementById('numPoints').innerText);
      " />
      <span id="numVertices">3</span>
    </td>
  </tr>
  <tr>
    <th>Verh√§ltnis</th>
    <td>
      <input type="range" min="0" max="100" value="50" style="width: 60em" onchange="
        document.getElementById('lambda').innerText = this.value;
        chaosGame.lambda = this.value / 100;
        chaosGame.doReset(ctx);
        chaosGame.doFullGame(ctx, document.getElementById('numPoints').innerText);
      " />
      <span id="lambda">50</span>
    </td>
  </tr>
  <tr>
    <th>Automatischer Durchlauf</th>
    <td>
      mit
      <input type="range" min="1" max="20000" value="1" style="width: 60em" onchange="
        document.getElementById('numPoints').innerText = this.value;
        chaosGame.doReset(ctx);
        chaosGame.doFullGame(ctx, this.value);
      " />
      <span id="numPoints">1</span>
      Punkten
    </td>
  </tr>
  <tr>
    <th>Manueller Durchlauf</th>
    <td>
      <input type="submit" value="Ein Schritt bitte!" onclick="
        var j = Math.floor(Math.random() * chaosGame.vertices.length);
        var p = chaosGame.vertices[j];

        chaosGame.doStep(ctx, p, j);
        recordVertex(j);
        recordStep();
      " />
<div id="a">abc</div>

    </td>
  </tr>
  <tr>
    <th>Hilfslinien einzeichnen</th>
    <td>
      <input type="checkbox" onchange="
        chaosGame.trackLines = this.checked;
      " />
    </td>
  </tr>
</table>

</body>
</html>
